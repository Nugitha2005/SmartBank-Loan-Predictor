

# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage, Label
import pandas as pd
import joblib
from tkinter import messagebox  
from groq import Groq

client = Groq(api_key="PASTE_YOUR_API_KEY_HERE")

try:
    model = joblib.load('loan_model.pkl')  
    model_columns = joblib.load('model_columns.pkl')
    print("Model Loaded!")
except:
    print("Error: Could not find .pkl files. Copy them into the build folder!")



def check_loan():
    try:
        # 1. Get Inputs
        val_income = float(entry_1.get())
        val_co_income = float(entry_2.get())
        val_loan = float(entry_3.get())
        val_credit = float(entry_4.get())
        val_married = float(entry_5.get())

       
        row = pd.DataFrame([[val_income, val_co_income, val_loan, val_credit, val_married]],
                           columns=model_columns)
        prediction = model.predict(row)[0]

       
        status = "APPROVED" if prediction == 1 else "REJECTED"

        
        ai_result_label.config(text="AI is thinking...", fg="blue")
        window.update()  

        prompt = f"""
        You are a senior bank manager at SmartBank. 
        A customer applied for a loan with these details:
        - Income: ${val_income}
        - Co-Applicant Income: ${val_co_income}
        - Loan Amount: ${val_loan}
        - Credit History: {val_credit} (1.0 is Good, 0.0 is Bad)
        - Married: {val_married}

        Our AI system has {status} this loan.
        Please write a polite, 2-sentence explanation telling the customer WHY. 
        Be professional but clear.
        """

        chat_completion = client.chat.completions.create(
            messages=[{"role": "user", "content": prompt}],
            model="llama-3.3-70b-versatile",
        )

        
        ai_explanation = chat_completion.choices[0].message.content

       
        ai_result_label.config(text=f"STATUS: {status}\n\n{ai_explanation}", fg="black")

       
        if prediction == 1:
            messagebox.showinfo("Success", "LOAN APPROVED!")
        else:
            messagebox.showwarning("Sorry", "LOAN REJECTED")

    except ValueError:
        messagebox.showerror("Error", "Please check your numbers!")
    except Exception as e:
        ai_result_label.config(text=f"AI Error: {e}")

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"C:\Users\nugit\PycharmProjects\SmartBank\build\build\assets\frame0")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


window = Tk()



window.geometry("876x8000")
window.configure(bg = "#F4F6F9")


canvas = Canvas(
    window,
    bg = "#F4F6F9",
    height = 870,
    width = 870,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)
canvas.create_text(
    301.0,
    16.0,
    anchor="nw",
    text="SMART BANK",
    fill="#002147",
    font=("CoveredByYourGrace", 48 * -1)
)

entry_image_1 = PhotoImage(
    file=relative_to_assets("entry_1.png"))
entry_bg_1 = canvas.create_image(
    198.0,
    194.0,
    image=entry_image_1
)
entry_1 = Entry(
    bd=0,
    bg="#D9D9D9",
    fg="#000716",
    highlightthickness=0
)
entry_1.place(
    
    x=40.0,
    y=176.0,
    width=316.0,
    height=34.0
)

entry_image_2 = PhotoImage(
    file=relative_to_assets("entry_2.png"))
entry_bg_2 = canvas.create_image(
    435.0,
    350.0,
    image=entry_image_2
)
entry_2 = Entry(
    bd=0,
    bg="#D9D9D9",
    fg="#000716",
    highlightthickness=0
)
entry_2.place(
    x=277.0,
    y=332.0,
    width=316.0,
    height=34.0
)

entry_image_3 = PhotoImage(
    file=relative_to_assets("entry_3.png"))
entry_bg_3 = canvas.create_image(
    135.0,
    518.0,
    image=entry_image_3
)
entry_3 = Entry(
    bd=0,
    bg="#D9D9D9",
    fg="#000716",
    highlightthickness=0
)
entry_3.place(
    x=87.0,
    y=500.0,
    width=96.0,
    height=34.0
)

entry_image_4 = PhotoImage(
    file=relative_to_assets("entry_4.png"))
entry_bg_4 = canvas.create_image(
    714.0,
    518.0,
    image=entry_image_4
)
entry_4 = Entry(
    bd=0,
    bg="#D9D9D9",
    fg="#000716",
    highlightthickness=0
)
entry_4.place(
    x=666.0,
    y=500.0,
    width=96.0,
    height=34.0
)

entry_image_5 = PhotoImage(
    file=relative_to_assets("entry_5.png"))
entry_bg_5 = canvas.create_image(
    694.0,
    194.0,
    image=entry_image_5
)
entry_5 = Entry(
    bd=0,
    bg="#D9D9D9",
    fg="#000716",
    highlightthickness=0
)
entry_5.place(
    x=536.0,
    y=176.0,
    width=316.0,
    height=34.0
)

canvas.create_rectangle(
    118.0,
    610.0,
    760.0,
    857.0,
    fill="#D9D9D9",
    outline="")

canvas.create_text(
    39.0,
    126.0,
    anchor="nw",
    text="Income",
    fill="#000000",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    386.0,
    291.0,
    anchor="nw",
    text="Loan Amount",
    fill="#000000",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    648.0,
    456.0,
    anchor="nw",
    text="Married(0/1)",
    fill="#000000",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    69.0,
    453.0,
    anchor="nw",
    text="Credit History(0/1)",
    fill="#000000",
    font=("Inter", 16 * -1)
)

canvas.create_text(
    537.0,
    126.0,
    anchor="nw",
    text="Co - Applicant        Income",
    fill="#000000",
    font=("Inter", 16 * -1)
)

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=check_loan,
    relief="flat",

)
button_1.place(
    x=313.0,
    y=500.0,
    width=244.0,
    height=44.0
)
# --- AI RESULT LABEL ---

ai_result_label = Label(
    window,
    text="AI Overview will appear here...",
    font=("Arial", 11),
    bg="#D9D9D9",  
    fg="#000000",
    justify="left",
    anchor="nw",
    wraplength=600  
)
ai_result_label.place(x=125, y=615, width=620, height=230)
window.resizable(False, False)
window.mainloop()
